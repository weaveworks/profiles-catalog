apiVersion: capi.gitops.solutions/v1alpha1
kind: ClusterBootstrapConfig
metadata:
  name: clusterbootstrapconfig-sample
  namespace: default
spec:
  clusterSelector:
    matchLabels:
      weave.works/spike: upa
  jobTemplates:
    - name: 'gitopsify-leaf'
      spec:
        containers:
        - image: wego:0.0.0
          name: gitops-install
          resources: {}
          volumeMounts:
          - name: kubeconfig
            mountPath: "/etc/gitops"
            readOnly: true
          args: ["beta", "install", "--override-in-cluster", "--app-config-url", "ssh://git@github.com/palemtnrider/qb8.git"]
          env: 
          - name: KUBECONFIG
            value: "/etc/gitops/value"
          - name: GITHUB_TOKEN
            valueFrom: 
              secretKeyRef:
                name: my-pat
                key: GITHUB_TOKEN        
        restartPolicy: Never
        volumes:
        - name: kubeconfig
          secret:
            secretName: '{{ .ObjectMeta.Name }}-kubeconfig'
